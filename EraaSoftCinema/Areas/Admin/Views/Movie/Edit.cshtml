@model MovieAllInfo


<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>Edit Movie</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <!-- Bootstrap 5 CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body class="bg-light">
    <form method="post" asp-area="Admin" asp-controller="Movie" asp-action="Edit" enctype="multipart/form-data">
        <div class="container mt-12">
            <div class="row justify-content-center">
                <div class="col-md-12">

                    <div class="card shadow-sm">
                        <div class="card-header bg-primary text-white">
                            <h5 class="mb-0">Edit Item</h5>
                        </div>

                        <div class="card-body">

                                <input type="hidden" asp-for="movie.id" />

                                <!-- Name - - status -->
                                <div class="row">
                                    <div class="col-md-6 mb-3">
                                        <label class="form-label">Title</label>
                                        <input type="text" class="form-control" asp-for="movie.title">
									<span class="text-danger" asp-validation-for="movie.title"></span>
                                    </div>

                                    <div class="col-md-6 mb-3">
                                        <label class="form-label">Status</label>
                                        <select asp-for="movie.status" class="form-select">
                                        <span class="text-danger" asp-validation-for="movie.status"></span>
                                        <option value="true">Active</option>
                                            <option value="false">Inactive</option>
                                        </select>
                                    </div>
                                </div>

                                <div class="row">
                                    <div class="col-md-6 mb-3">
                                        <label class="form-label">Director</label>
                                        <input type="text" class="form-control" asp-for="movie.director">
									<span class="text-danger" asp-validation-for="movie.director"></span>
                                    </div>

                                    <div class="col-md-6 mb-3">
                                        <label class="form-label">ReleaseYear</label>
                                    <input type="number"
                                           class="form-control"
                                           asp-for="movie.releaseYear"
                                           min="2000"
                                           max="2099"
                                           step="1"
                                           placeholder="YYYY" />						
                                           <span class="text-danger" asp-validation-for="movie.releaseYear"></span>
                                    </div>
                                </div>



                            <div class="row">
                                <div class="col-md-6 mb-3">
                                    <label class="form-label">Genre</label>
                                    <input type="text" class="form-control" asp-for="movie.genre">
                                    <span class="text-danger" asp-validation-for="movie.genre"></span>
                                </div>

                                <div class="col-md-6 mb-3">
                                    <label class="form-label">Duration</label>
                                    <input type="number" class="form-control" asp-for="movie.Duration">
                                    <span class="text-danger" asp-validation-for="movie.Duration"></span>
                                </div>
                            </div>





                                <div class="row">
                                  <div class="col-md-6 mb-3">
                                        <label class="form-label">Price</label>
                                        <input type="number" step="0.01" class="form-control" asp-for="movie.Price">
									<span class="text-danger" asp-validation-for="movie.Price"></span>
                                    </div>
                                <div class="col-md-6 mb-3">
                                    <label class="form-label">Category</label>
                                    <select class="form-select" asp-for="movie.languageId">
                                        <option value="">-- Select Language --</option>
                                        @foreach (var lang in Model.Languages)
                                        {
                                            <option value="@lang.id">@lang.name</option>
                                        }
                                    </select>
                                    <span class="text-danger" asp-validation-for="movie.languageId"></span>
                                </div>
                                </div>

                                <div class="row">
                                    <div class="col-md-12 mb-3">
                                        <label class="form-label">Description</label>
                                        <textarea class="form-control"
                                                  asp-for="@Model.movie.description"
                                                  rows="5"></textarea>
                                    </div>

                                </div>

                                <div class="row">
                                    <div class="col-md-6 mb-3">
                                        <label class="form-label">Category</label>
                                        <select class="form-select" asp-for="movie.CategoryId">
                                            <option value="">-- Select Category --</option>
                                            @foreach (var category in Model.Categories)
                                            {

                                            <option value="@category.id"
                                                    selected="@(category.id == Model.movie.CategoryId)">
                                                @category.name
                                            </option>
                                            }
                                        </select>
                                        <span class="text-danger" asp-validation-for="movie.CategoryId"></span>
                                    </div>
                                </div>


                                <!-- Image Name -->
                            <div class="row">


                                <div class="col-md-12 mb-3">
                                    <div class="card">
                                        <label class="form-label">Movie Main Image</label>
                                        <input type="file" name="Mainfile" id="Mainfile" class="form-control" />
                                        <img id="MainfilePreview"
                                             src="~/img/Movies/Mimgs/@Model.movie.MainImgUrl"
                                             alt="Main Image Preview"
                                             style="width: 60%; height: 60%; object-fit: cover;">



                                        <div class="card-body">
                                            <p class="text-muted text-center">Current Movie Image</p>
                                        </div>
                                    </div>
                                </div>

                                <div class="col-md-12 mb-3">
                                    <div class="card">

                                        <h5>Current Actors</h5>
                                        <div id="SubActorsPreview" class="d-flex flex-wrap gap-3 mt-3">
                                            @if (Model.movie.actorMovies != null && Model.actors.Any())
                                            {
                                                foreach (var actor in Model.movie.actorMovies)
                                                {
                                                    <div class="text-center">
                                                        <img src="~/img/Actors/@actor.Actor.imgUrl"
                                                             style="width:80px;height:80px;object-fit:cover;"
                                                             class="rounded-circle shadow-sm mb-1" />
                                                        <div class="small fw-bold">@actor.Actor.imgUrl</div>
                                                    </div>
                                                }
                                            }
                                            else
                                            {
                                                <p class="text-muted">No actors assigned yet.</p>
                                            }
                                        </div>
                                    </div>

                                </div>






                                <div class="col-md-12 mb-3">
                                          <label class="form-label mb-0">Select/Modify Actors</label>
                                        </div>
                                        <div class="card-body" style="max-height: 400px; overflow-y: auto;">
                                    <div id="ActorsIds" class="row">
                                                @if (Model.actors != null)
                                                {
                                                    foreach (var actor in Model.actors)
                                                    {
                                                        <div class="col-6 col-sm-4 col-md-3 mb-3">
                                                            <div class="d-flex flex-column align-items-center p-2 border rounded">
                                                                <img src="~/img/Actors/@actor.imgUrl"
                                                                     style="width:100px;height:100px;object-fit:cover;"
                                                                     class="rounded mb-2" />

                                                                <div class="form-check">
                                                                    <input type="checkbox"
                                                                           class="form-check-input"
                                                                   name="ActorsIds"
                                                                           id="actor_@actor.id"
                                                                           value="@actor.id"
                                                                   @(Model.movie.actorMovies.Any(am => am.ActorId == actor.id) ? "checked" : "") />                                                                  <label class="form-check-label small" for="actor_@actor.id">
                                                                    <label>@actor.name </label>
                                                                </div>
                                                            </div>
                                                        </div>
                                                    }
                                                }
                                            </div>
                                </div>




                                        <div class="card-body">
                                            <p class="text-muted text-center">all Actors Images</p>
                                        </div>
                            </div>
                         </div>
                        <div style="padding : 30px">


                            <label class="form-label">Movie Sub Images</label>
                            <input type="file" name="Subfiles" id="Subfiles" multiple class="form-control" />

                            <div id="SubfilesPreview" class="d-flex flex-wrap gap-2 mt-2">

                                @if (Model.movie.MovieSubimgs != null && Model.movie.MovieSubimgs.Any())
                                {
                                    foreach (var img in Model.movie.MovieSubimgs)
                                    {
                                        <img src="~/img/Movies/SubImgs/@img.SubImgUrl"
                                             style="width:100px;height:100px;object-fit:cover;"
                                             class="rounded shadow-sm" />
                                    }
                                }
                            </div>


                        </div>
                        <div class="mb-3">
                            <!-- Buttons -->
                            <div class="d-flex justify-content-end">
                                <button type="submit" class="btn btn-success">
                                    Submit
                                </button>
                            </div>

                        </div>
                            
                     </div>

                                           
                    </div>

                </div>
            </div>
    </form>
    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>


	<section>
        <script>
            const mainFileInput = document.getElementById('Mainfile');
            const mainFilePreview = document.getElementById('MainfilePreview');

            mainFileInput.addEventListener('change', function() {
                const file = this.files[0];
                if (file) {
                    const reader = new FileReader();
                    reader.onload = function(e) {
                        mainFilePreview.src = e.target.result;
                    }
                    reader.readAsDataURL(file);
                }
            });
        </script>


        <script>
            const subFilesInput = document.getElementById('Subfiles');
            const subFilesPreview = document.getElementById('SubfilesPreview');

            subFilesInput.addEventListener('change', function() {
                subFilesPreview.innerHTML = ''; // clear old previews

                const files = Array.from(this.files);
                files.forEach(file => {
                    const reader = new FileReader();
                    reader.onload = function(e) {
                        const img = document.createElement('img');
                        img.src = e.target.result;
                        img.style.width = '100px';
                        img.style.height = '100px';
                        img.style.objectFit = 'cover';
                        img.classList.add('rounded', 'shadow-sm', 'me-2', 'mb-2');
                        subFilesPreview.appendChild(img);
                    }
                    reader.readAsDataURL(file);
                });
            });
        </script>
        <script>
            const actorsInput = document.getElementById('actors');
            const actorPreview = document.getElementById('SubActorsPreview');

            actorsInput.addEventListener('change', function() {
                actorPreview.innerHTML = ''; // clear old previews

                const files = Array.from(this.files);
                files.forEach(file => {
                    const reader = new FileReader();
                    reader.onload = function(e) {
                        const img = document.createElement('img');
                        img.src = e.target.result;
                        img.style.width = '100px';
                        img.style.height = '100px';
                        img.style.objectFit = 'cover';
                        img.classList.add('rounded', 'shadow-sm', 'me-2', 'mb-2');
                        actorPreview.appendChild(img);
                    }
                    reader.readAsDataURL(file);
                });
            });
        </script>
    </section>



    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>



    @section Scripts {
        <partial name="_ValidationScriptsPartial" />
    }


</body>
</html>
